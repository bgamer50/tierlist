<!DOCTYPE html>
<html>
	<head>
		<link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
		<script type="text/javascript" src="/jquery"></script>
		<script type="text/javascript">
			window.filename = "";
			function getArguments() {
				var parameters = location.search.substring(1).split("&");

    			var temp = parameters[0].split("=");
    			window.filename = unescape(temp[1]);
    			WebSocketActivate();
			}
			function WebSocketActivate() {
            	if ("WebSocket" in window) {
                	var ws = new WebSocket("ws://localhost:8888/w?Id=123456789");
                	ws.onopen = function() {
                    	ws.send(window.filename);
                	};
                	ws.onmessage = function (evt) { 
                	    var received_msg = evt.data;
                	    console.log(received_msg);
                	    window.file = $.parseJSON(received_msg);
                	    parseData();
                	};
                	ws.onclose = function() { 
                    	return;
                	};
            	} else {
                	//WebSockets not supported by browser
                	return;
            	}
        	}
			function parseData() {
				fields = ['field1', 'field2', 'field3'];
				data = [];
				for(var k = 0; k < window.file.length; k++) {
					data.push({field1: window.file[k][0], field2: window.file[k][1], field3: window.file[k][2]});
				}
				var rows = '';
        		$.each(data, function(index, item) {
            		var row = '<tr>';
           			$.each(fields, function(index, field) {
                		row += '<td>' + item[field+''] + '</td>';
            		});
            		rows += row + '<tr>';
        		});
        		$('#' + 'listtable' + ' tbody').html(rows);
			}
			//window.onload = getArguments;
		</script>
		<style>
			html {
				background-color:rgb(255,100,100);
			}

			body {
				font-family:"Raleway";
				font-size:14pt;
			}

			mh {
				font-familiy:"Raleway";
				font-size:17pt;
				font-weight:bold;
			}

			h1 {
				font-family:"Raleway";
				font-size:30pt;
			}
			table.main {
				border-collapse: separate;
				border-spacing: 4em 1em;
				text-align:center;
			}
			table.main tr th thead {
				font-weight:bold;
			}
			table.main tr td tbody {
				font-weight:normal;
			}

		</style>
		<title>List View</title>
	</head>
	
	<body>
		<a href="/">Back</a><br/><br/>
		<mh>
			<script type="text/javascript">
				getArguments();
				document.write("Displaying " + window.filename + ":")
			</script>
		</mh>
		<table id="listtable" class="main">
			<thead>
				<tr><th>Picture</th><th>Name</th><th>Rank</th></tr>
			</thead>
			<tbody>
				<tr><td>N/A</td><td>Fox</td><td>1</td></tr>
			</tbody>
		</table>
	</body>
</html>